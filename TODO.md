# AI集成之后的UI优化 2025-12-26

## 右边栏

- [ ] 着法评估：改用一个4-5列的表格，列出主要候选着法的数据：着法、胜率（变化）、目数变化、计算量、占比（这个可选，要是数据太拥挤这一列可以不要）等
- [ ] 形势评估：应设计为一个缩小的棋盘，展示目前AI引擎计算的最佳路径下（显示之后若干步，显示从1开始的手数，不断更新显示），全局各个交叉点可能的归属（用黑白灰度展示确定性）；这部分还没实现前先用一个正方形占位区域表示

## 左边栏

- [ ] 胜率：
  - 上面展示一个实时胜率条，左黑右白（可能需要一个灰色的边框以免视觉上混入背景），分别展示黑白双方胜率
  - 在这个胜率条下面展示一个折线图，展示盘面目数差（黑减白）和黑胜率随着手数的变化，展示从第一手到当前手的折线
    - 如果能在加载棋局后快速分析全局并展现整局的胜率折线，然后把根据当前手数显示一条移动的竖虚线，效果会更好

- [ ] AI 分析：合并到引擎区域，见下
- [ ] 引擎日志：改名“AI 引擎”，把AI引擎的配置/选择、启动/停止、状态消息和引擎日志合并到一起：

  - 最上面是启动和停止引擎的按钮（目前“AI分析”区域的那个按钮），但在它右侧增加一个配置按钮（为节省空间可以只显示图标不需要文字），用于打开AI相关配置、选择的sheet
    - 可以设置不同引擎的可执行程序、启动参数等，并快速选择切换
    - 可以设置AI分析相关的参数，比如AI分析overlay的一些选项
    - 引擎配置参数有很多，设置界面应该优先显示最常用的参数，而高级参数可以折叠起来，仅供高级用户使用
  - 下面一行是状态和消息显示
    - 左侧是一个状态图标（“分析中”“出错”等用不同图标或动画表示）
    - 状态图标右边是文字显示区域，显示引擎（view-model）消息，即把现在棋盘上方最右侧的那个文本显示区域搬过来（记得让它可选择和拷贝）
  - 再下面是与引擎通信的日志，目前这些日志在console的stdio可以看到，应该显示在这里（可选择和拷贝，自动滚动到最新日志），这里需要考虑，GTP通信和Analysis API通信的log是放在一起还是用两个tab区分开？

## 棋盘上的引擎分析overlay显示

- [ ] 落子（无论手工还是浏览棋谱中的着法导致棋局状态改变）时，应立即移除上一步所有overlay，显示新的棋盘状态，然后再和引擎通信、显示新的overlay，目前顺序有问题，导致新落的子可能被旧overlay遮住

- [ ] 棋盘overlay总体设计

  - 显示手数：应该可以在棋盘上方工具条选择（将现在的checkbox换成下拉列表）：显示全部，显示最近10手、最近5手、最近1手，或者不显示
  - 标记最近着法：标记当前局面的最新三手棋是常用的惯例，当且仅当不显示手数时激活，在最近一手棋子（“-1”）内绘制一个棋子一半半径的空心圆圈，对黑子用白子的主色（在theme设定中的fill颜色）画圈，对白子用黑子的主色画圈；对更前面的两手棋（“-2”和“-3”），在棋子中间绘制棋子1/4半径的实心小圆，用色同上
    - 目前theme设置中的 `lastMoveMarkerColor` 不再需要，可以改为下面的标记下一手功能需要设定的颜色 `nextMoveMarkerColor`
  - 标记下一手：启用AI分析的情况下，会看到下一手的大量AI选点，提前知道棋谱实际的下一手有很多好处，所以在启用AI分析的情况下，应该用theme设置的 `nextMoveMarkerColor` 绘制一个和棋子大小一样的空心圆圈（注意不要被AI候选着法overlay挡住）
  - AI候选着法：展示AI推荐的候选着法，每个都是一个有一定透明度的、和棋子一样大的圆形overlay，不需要阴影、高光等特效，具体设计：
    - 背景颜色：首选着法（胜率第一）用蓝色，胜率与首选着法差距不大（比如在1%或者2%以内）的着法用绿色，其他着法可以用比目前wood主题的棋盘底色深一些的橙黄色，这些颜色应该可以在theme中配置，这里说的是针对默认wood主题的建议选择，对黑白book主题，可能也可用
    - 显示数值：
      - 可以在AI分析设置中设置数值是永远针对黑棋还是根据当前行棋一方显示对应数值
      - 应包含胜率、计算量、目数差三个数值，第一个较大、加粗，另两个放在下面，字体较小较细
      - 为节省空间，胜率的“%”可以省略
    - 在排位前9的候选着法overlay的右上角显示一个小的数字表示其排名，为了醒目可以使用某种合适的背景色、文字色组合
  - AI候选着法的后续进程：当鼠标悬停于某个候选着法上时，应显示走这个着法的后续双方着法进程（以AI引擎计算的已知最佳路径为准）
    - 鼠标悬停开始就隐藏其他AI候选着法overlay
    - 然后对这一着法本身绘制对应的棋子，上面仍显示前述的胜率、计算量和目数差数值，后续着法也绘制对应颜色的棋子，并从2开始显示手数序号
    - 当鼠标移开后，这些临时绘制的棋子都消失，重新显示之前隐藏的AI候选着法overlay
    - 为了显示性能，可能这个功能需要的候选着法的后续进程数据都要一次性从引擎获取（每次引擎更新评估数据都同步到GUI侧），而不是每次鼠标悬停才去请求获取

注意：因为我们后面会实现引擎的渐进加深计算，也就是会不断请求引擎更新数据，所以AI overlay都是不断更新的，性能问题需要尽早考虑。

