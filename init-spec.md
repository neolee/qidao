# 项目概述

开发一个围棋打谱和 AI 分析工具，参考 Lizzieyzy（一个基于 Java 的开源围棋 GUI，支持 SGF 文件处理和 GTP 引擎集成，主界面[如图](screens/lizzie-yzy.png)）。新工具将聚焦于核心功能：SGF 文件读写、棋谱导航与编辑、AI 分析（包括着法建议、胜率评估和局面分数）。相比参考工具，新工具强调更现代的美观 UI、更流畅的性能、macOS 优先支持（包括 native 外观和优化），并兼容 Windows（可选）。采用模块化架构，便于扩展（如添加新引擎支持或分析模式）和维护（易于测试和迭代）。

- 工具名称：QiDao (means ‘Tao of Go’ in English)
- 目标用户：围棋爱好者、职业棋手和开发者
- 开发优先级：先实现 macOS 版本的核心功能，可行的情况下再扩展到 Windows。

# 功能需求

功能分为核心模块和扩展模块。核心模块覆盖基本打谱和 AI 分析；扩展模块基于参考工具的进阶特性，便于后续迭代。

## 1. 文件处理模块 SGF Handling
   - 支持读写标准 SGF 文件（Smart Game Format，包括棋谱、分支、注释、标签）。
   - 功能：
     - 加载 SGF 文件：解析棋谱，显示初始局面，支持多分支树结构。
     - 保存 SGF 文件：导出当前棋局，包括编辑的移动、变招和分析结果（e.g., 胜率标签）。
     - 编辑棋谱：添加/删除移动、创建分支、添加文本注释或标签（e.g., "好手" 或 "坏手"）。
     - 支持批量处理：导入多个 SGF 文件进行分析（参考 Lizzieyzy 的 Batch Analyze）。
   - 错误处理：验证 SGF 格式，处理无效文件时提供友好提示。

## 2. 棋盘交互模块 Board Interaction
   - 19x19 标准围棋棋盘显示（支持自定义大小，如 9x9 或 13x13）。
   - 功能：
     - 手动放置石头：支持黑白交替，检测非法移动（e.g., 自杀或重复局面）。
     - 导航棋谱：前进/后退移动、跳转到特定手数、切换分支。
     - 显示信息：实时显示手数、俘子数、komi（贴目）、规则（中国/日本规则切换）。
     - 交互元素：鼠标 hover 显示坐标，点击放置石头，支持 undo/redo。
     - 美观增强：支持主题切换（e.g., 木纹/纯色棋盘），石头样式（2D/3D 渲染），高 DPI 支持以避免模糊。

## 3. AI 分析模块 AI Analysis
   - 通过标准 GTP (Go Text Protocol) 协议或 KataGo Analysis API 连接引擎，如 KataGo、Leela Zero 等。
   - 功能：
     - 引擎连接：用户配置引擎路径、参数（e.g., GPU/CPU 模式、线程数），支持自动检测和启动。
     - 实时分析：对当前局面分析最佳着法（top candidates with probabilities）、胜率（win rate %）、分数（score mean/lead）、变招树（variations with depth）。
     - 全局分析：快速分析整个棋谱（参考 Lizzieyzy 的 Flash Analyze），生成胜率曲线图、准确率统计（e.g., blunder detection）。
     - 盲点分析：对比用户实战着法与 AI 前五选点的分差，自动标记“大勺子”（Blunders）。
     - 领土估计：调用引擎命令估算 territory，支持自动更新。
     - 双引擎模式：同时运行两个引擎，比较分析结果（e.g., 侧边栏显示对比）。
     - Tsumego 支持：选中局部区域，生成框架石头，引擎专注分析生死问题。
     - 引擎对战：两个引擎自动对弈，记录多局统计（e.g., Elo 分、胜率）。
   - 输出显示：变招树（树状图或列表）、胜率图（折线图）、表格（e.g., 着法概率、分数差）。

## 4. 用户界面模块 UI Features
   - 主界面布局（参考附件截图）：中央棋盘、左侧分析面板（胜率、变招）、右侧工具栏/图表、底部导航栏。
   - 功能：
     - 工具栏：快速按钮 for 新游戏、加载 SGF、启动分析、切换引擎、主题设置。
     - 图表视图：胜率曲线、准确率柱状图、blunder 列表。
     - 变招树可视化：实现图形化、可缩放的变招树结构，直观展示多层分支关系。
     - 搜索与过滤：棋谱内搜索特定移动或注释。
     - 帮助系统：内置教程、引擎配置指南。
   - 扩展：支持棋谱分享（导出 PNG/SVG 棋盘截图）。

## 5. 扩展模块 Future-Proof Features
   - 板同步：与在线平台（如 FoxWQ）同步棋盘（可选，Windows 优先）。
   - 批量分析：处理文件夹内多个 SGF，生成报告。
   - 云集成：可选上传棋谱到云端分析（需用户同意）。
   - 自定义脚本：允许用户添加 Python 脚本扩展分析逻辑。

# 非功能需求

## 1. 性能与流畅性
   - 响应时间：AI 分析延迟 < 1 秒（依赖引擎），UI 操作无卡顿。
   - 渲染性能：采用 GPU 加速渲染棋盘，支持高帧率（60/120fps）下的实时分析显示。
   - 资源优化：低内存占用（< 500MB 闲置时），支持多线程分析。
   - 测试：单元测试覆盖 80% 代码，性能基准（e.g., 加载 1000 手棋谱 < 2 秒）。

## 2. 美观与可用性
   - UI 设计：现代、简洁（Material Design 或 macOS native style），响应式布局（窗口缩放时自适应）。
   - 国际化与本地化：架构上支持多语言本地化，初期版本优先支持中文，后续扩展英文及其他语言。
   - 无障碍：键盘快捷键、颜色盲模式。
   - 自定义：用户可调整字体大小、颜色方案。

## 3. 平台支持
   - 优先 macOS：使用 native 框架确保无缝集成（e.g., 支持 Dark Mode、Touch Bar）。
   - Windows 支持：跨平台兼容，无需额外依赖。
   - 最小系统要求：macOS 12+，Windows 10+，4GB RAM。

## 4. 安全与可靠性
   - 无网络依赖（除可选云功能），本地运行引擎。
   - 错误恢复：崩溃时自动保存棋谱。
   - 日志：记录引擎输出和错误，便于调试。

## 5. 可维护性与扩展性
   - 模块化：每个模块独立（e.g., UI 不依赖具体引擎实现）。
   - 文档：代码注释、API 文档、开发指南。
   - 版本控制：使用 Git，支持插件系统（e.g., 动态加载新分析模块）。